(() => {
  const FETCH_PRODUCTS_URL =
    "https://gist.githubusercontent.com/sevindi/8bcbde9f02c1d4abe112809c974e1f49/raw/9bf93b58df623a9b16f1db721cd0a7a539296cf0/products.json";
  const PRODUCTS_LOCALSTORAGE_KEY = "products_data";
  let data = [];

  const init = () => {
    // The codes should only work on the homepage, otherwise print "wrong page" to the console
    if (window.location.pathname !== "/") return console.log("wrong page");

    buildHTML();
    buildCSS();
    setEvents();
    fetchProducts();
  };

  function buildHTML() {
    const html = `
            <div class="container">
              <div class="carousel-title-container">
                <h2 class="carousel-title">
                  Beğenebileceğinizi Düşündüklerimiz
                </h2>
              </div>

              <div class="carousel-slider">
                <div class="carousel-products-wrapper">
                  <div class="carousel-products"></div>
                </div>

                <div class="carousel-arrows">
                  <button aria-label="Back" id="carousel-arrow-prev"></button>
                  <button aria-label="Next" id="carousel-arrow-next"></button>
                </div>
              </div>
            </div>`;

    const section = document.querySelector(".Section2A");

    section.insertAdjacentHTML("afterbegin", html);
  }

  function buildCSS() {
    const css = `
            .carousel-title-container {
              display: flex;
              align-items: center;
              justify-content: space-between;
              background-color: #fef6eb;
              padding: 25px 67px;
              border-top-left-radius: 35px;
              border-top-right-radius: 35px;
              font-family: Quicksand-Bold;
              font-weight: 700;
            }

            .carousel-title {
              font-family: Quicksand-Bold;
              font-size: 3rem;
              font-weight: 700;
              line-height: 1.11;
              color: #f28e00;
              margin: 0;
            }

            .carousel-slider {
              transform: translate3d(0px, 0px, 0px);
              transition: all 0.25s;
              position: relative;
              margin-bottom: 50px;
            }

            .carousel-products-wrapper {
              overflow: hidden;
              box-shadow: 15px 15px 30px 0 #ebebeb80;
              background-color: #fff;
              border-bottom-left-radius: 35px;
              border-bottom-right-radius: 35px;
            }

            .carousel-arrows button {
              position: absolute;
              bottom: 50%;
              top: auto;
              width: 50px;
              height: 50px;
              background-position: 18px;
              border-radius: 50%;
            }

            #carousel-arrow-prev:hover, #carousel-arrow-next:hover {
              background-color: #fff;
              border: 1px solid #f28e00;
            }
            
            #carousel-arrow-prev {
              background: url(/assets/svg/prev.svg) no-repeat;
              background-color: #fef6eb;
              left: -65px;
              background-position: center;
            }

            #carousel-arrow-next {
              background: url(/assets/svg/next.svg) no-repeat;
              background-color: #fef6eb;
              right: -65px;
              background-position: center;
            }

            .carousel-products {
              display: flex;
              transition: transform 0.3s ease-in-out;
              user-select: none;
            }

            .carousel-product-card {
              display: block;
              position: relative;
              margin: 20px 0 20px 3px;
              width: 242px;
              margin-right: 20px;
              padding: 5px;
              border-radius: 10px;
              border: 1px solid #ededed;
              font-size: 12px;
              font-family: Poppins, "cursive";
              color: #7d7d7d;
              text-decoration: none;
              background-color: #fff;
              z-index: 1;
              flex-shrink: 0;
              user-select: none;
            }

            .carousel-product-card:hover {
              box-shadow: 0 0 0 0 #00000030,inset 0 0 0 3px #f28e00;
            }

            .carousel-product-content {
              padding: 0 17px 87px;
            }

            .carousel-product-img {
              display:block;
              width: 100%;
              max-width: 100% !important;
              height: 203px;
              object-fit: contain;
              margin-bottom: 45px;
              user-select: none;
              pointer-events: none;
            }

            .carousel-product-title {
              height: 42px;
              margin-bottom: 10px;
              overflow: hidden;
              font-size: 1.2rem;
              font-family: Poppins, "cursive";
              color: #7d7d7d;
            }

            .carousel-product-bottom {
              padding: 0 17px 17px 13px;
              margin-top: auto;
            }

            .carousel-product-add-to-cart {
              width: 100%;
              padding: 15px 20px;
              border-radius: 37.5px;
              background-color: #fff7ec;
              color: #f28e00;
              font-family: Poppins, "cursive";
              font-size: 1.4rem;
              font-weight: 700;
              transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out;
            }
              
            .carousel-product-add-to-cart:hover {
              background-color: #f28e00;
              color: #fff;
            }

            .stars-container {
              padding: 5px 0 15px;
              margin-bottom: .5rem;
            }

            .star-icon {
              height: 14px;
              width: auto;
              margin-inline: 2.5px 5px;
              fill: #d7d7d7;
            }

            .discount-icon {
              height: 22px;
              width: 22px;
              margin-left: 3px;
            }

            .product-price {
              display: block;
              width: 100%;
              font-size: 2.2rem;
              font-weight: 600;
              color: #7d7d7d;
            }

            .product-discounted-price {
              color: #00a365;
            }

            .price-container {
              display: flex;
              justify-content: flex-end;
              flex-direction: column;
              height: 43px;
            }

            .product-discount-container {
              display: flex;
              gap: .5rem;
              align-items: center;
            }

            .product-old-price {
              font-size: 1.4rem;
              font-weight: 500;
              text-decoration: line-through;
              color: #7d7d7d;
            }
            
            .product-discount-percentage {
              color: #00a365;
              font-size: 18px;
              font-weight: 700;
              display: inline-flex;
              justify-content: center;
            }

            .favorite-button {
              width: 50px;
              height: 50px;
              position: absolute;
              top: 10px;
              right: 15px;
              padding: 0;
              cursor: pointer;
              background-color: #fff;
              border-radius: 50%;
              box-shadow: 0 2px 4px 0 #00000024;
            }

            .favorite-button-default-icon {
              display: block;
              width: 25px;
              height: 25px;
              position: absolute;
              top: 13px;
              right: 12px;
            }

            .favorite-button .hovered {
              display: none;
            }

            .favorite-button:hover .hovered {
              display: block;
            }

            .favorite-button:hover .favorite-button-default-icon {
              display: none;
            }

            .favorite-button-icon {
              transition: opacity .3s ease-in-out;
            }

            .carousel-skeleton-card {
              display: block;
              position: relative;
              margin: 20px 0 20px 3px;
              padding: 0;
              width: 242px;
              margin-right: 20px;
              border-radius: 10px;
              border: 1.5px solid #f2fafe;
              background-color: #fff;
              flex-shrink: 0;
              user-select: none;
            }

            .carousel-skeleton-content {
              padding-bottom: 87px;
              margin-inline: 12px 18px;
            }

            .carousel-skeleton-img {
              width: 100%;
              height: 203px;
              background: #f2fafe;
              background-size: 200% 100%;
              border-radius: 8px 8px 0 0;
              margin-bottom: 45px;
            }

            .carousel-skeleton-title {
              height: 20px;
              background: #f2fafe;
              background-size: 200% 100%;
              border-radius: 360px;
              margin-bottom: 10px;
            }

            .carousel-skeleton-stars {
              height: 14px;
              width: 100px;
              background: #f2fafe;
              background-size: 200% 100%;
              border-radius: 360px;
              margin-bottom: 15px;
            }

            .carousel-skeleton-price {
              height: 24px;
              width: 80px;
              background: #f2fafe;
              background-size: 200% 100%;
              border-radius: 360px;
              margin-bottom: 20px;
            }

            .carousel-skeleton-button {
              width: calc(100% - 34px);
              height: 50px;
              background: #f2fafe;
              background-size: 200% 100%;
              border-radius: 360px;
              position: absolute;
              bottom: 17px;
              left: 17px;
              right: 17px;
            }

            .carousel-skeleton-box::after {
              position: absolute;
              top: 0;
              right: 0;
              bottom: 0;
              left: 0;
              transform: translateX(-100%);
              background-image: linear-gradient(90deg, #fff0, #fff3 20%, #ffffff80 60%, #fff0);
              animation: shimmer 3s infinite;
              content: "";
            }

            @keyframes shimmer {
              100% {
                transform: translateX(100%);
              }
            }

            @media screen and (max-width: 1480px) {
              .carousel-product-card, .carousel-skeleton-card {
                flex: 0 0 calc(25% - 17.25px);
              }
            }

            @media screen and (max-width: 1280px) {
              .carousel-product-card, .carousel-skeleton-card {
                flex: 0 0 calc(33% - 15.33px);
              }
            }

            @media screen and (max-width: 992px) {
              .carousel-product-card, .carousel-skeleton-card {
                flex: 0 0 calc(50% - 11.5px);
              }
            }

            @media screen and (max-width: 576px) {
              .carousel-arrows button {
                display: none;
              }

              .carousel-product-card, .carousel-skeleton-card {
                flex: 0 0 50%;
              }
            }

            @media screen and (max-width: 480px) {
              .carousel-title {
                font-size: 2.2rem;
                line-height: 1.5;
              }

              .carousel-title-container {
                padding: 0 22px 0 10px;
                background-color: #fff;
              }

              .carousel-product-add-to-cart {
                padding: 10px !important;
              }

              .carousel-product-card, .carousel-skeleton-card {
                padding: 8px !important;
                margin-right: 10px !important;
              }

              .star-icon {
                height: 11px !important;
              }
            }

            @media screen and (max-width: 376px) {
              .carousel-product-content {
                padding: 0 17px 87px 0 !important;
              }

              .carousel-product-bottom {
                padding: 5px 5px 10px 0 !important;
              }

              .star-icon {
                height: 9px !important;
              }
            }
            `;

    const style = document.createElement("style");
    style.innerHTML = css;
    document.head.appendChild(style);
  }

  function setEvents() {
    const prevArrow = document.querySelector("#carousel-arrow-prev");
    const nextArrow = document.querySelector("#carousel-arrow-next");
    const carouselProducts = document.querySelector(".carousel-products");

    let isDragging = false;
    let startX = 0;
    let currentX = 0;
    let hasDragged = false;
    let currentIndex = 0;

    function getCardWidth() {
      const firstCard = carouselProducts.querySelector(
        ".carousel-product-card"
      );
      // 265px = 242px card width + 20px margin-right + 3px margin-left
      if (!firstCard) return 265;

      const cardStyle = window.getComputedStyle(firstCard);
      const cardWidth = firstCard.offsetWidth;
      const margins =
        parseFloat(cardStyle.marginRight || 0) +
        parseFloat(cardStyle.marginLeft || 0);

      return margins + cardWidth;
    }

    function getVisibleCardsCount() {
      return Math.floor(carouselProducts.offsetWidth / getCardWidth()) || 1;
    }

    function updateCarousel() {
      const maxIndex = Math.max(0, data.length - getVisibleCardsCount());
      currentIndex = Math.max(0, Math.min(currentIndex, maxIndex));

      const translateX = -(currentIndex * getCardWidth());
      carouselProducts.style.transform = `translateX(${translateX}px)`;

      // Disabled / Active Arrows
      prevArrow.style.opacity = currentIndex === 0 ? "0.5" : "1";
      prevArrow.style.pointerEvents = currentIndex === 0 ? "none" : "auto";
      nextArrow.style.opacity = currentIndex >= maxIndex ? "0.5" : "1";
      nextArrow.style.pointerEvents =
        currentIndex >= maxIndex ? "none" : "auto";
    }

    prevArrow.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        updateCarousel();
      }
    });

    nextArrow.addEventListener("click", () => {
      const maxIndex = Math.max(0, data.length - getVisibleCardsCount());
      if (currentIndex < maxIndex) {
        currentIndex++;
        updateCarousel();
      }
    });

    window.addEventListener("resize", updateCarousel);

    // Drag operations
    function handleStart(e) {
      e.preventDefault();
      isDragging = true;
      hasDragged = false;
      startX = e.type.includes("mouse") ? e.clientX : e.touches[0].clientX;
      currentX = startX;
      carouselProducts.style.transition = "none";
      carouselProducts.style.cursor = "grabbing";
    }

    function handleMove(e) {
      if (!isDragging) return;

      e.preventDefault();
      currentX = e.type.includes("mouse") ? e.clientX : e.touches[0].clientX;
      const distanceX = currentX - startX;

      // If drag distance greater than 5 pixels set hasDragged true
      if (Math.abs(distanceX) > 5) hasDragged = true;

      const currentTranslate = -(currentIndex * getCardWidth());
      carouselProducts.style.transform = `translateX(${
        currentTranslate + distanceX
      }px)`;
      carouselProducts.style.cursor = "grabbing";
    }

    function handleEnd() {
      if (!isDragging) return;

      isDragging = false;
      carouselProducts.style.transition = "transform 0.3s ease-in-out";
      carouselProducts.style.cursor = "grab";

      const distanceX = currentX - startX;
      const threshold = getCardWidth() / 3;

      if (Math.abs(distanceX) > threshold) {
        if (distanceX > 0 && currentIndex > 0) {
          currentIndex--;
        } else if (distanceX < 0) {
          const maxIndex = Math.max(0, data.length - getVisibleCardsCount());

          if (currentIndex < maxIndex) currentIndex++;
        }
      }

      updateCarousel();

      if (hasDragged)
        setTimeout(() => {
          hasDragged = false;
        }, 10);
    }

    carouselProducts.addEventListener("contextmenu", (e) => {
      if (isDragging) e.preventDefault();
    });

    carouselProducts.addEventListener("dragstart", (e) => {
      e.preventDefault();
    });

    carouselProducts.addEventListener(
      "click",
      (e) => {
        if (hasDragged) {
          e.preventDefault();
          e.stopPropagation();
        }
      },
      true
    );

    carouselProducts.addEventListener("mousedown", handleStart);
    carouselProducts.addEventListener("mousemove", handleMove);
    carouselProducts.addEventListener("mouseup", handleEnd);
    carouselProducts.addEventListener("mouseleave", handleEnd);

    carouselProducts.addEventListener("touchstart", handleStart, {
      passive: false,
    });
    carouselProducts.addEventListener("touchmove", handleMove, {
      passive: false,
    });
    carouselProducts.addEventListener("touchend", handleEnd);

    // Disable prev arrow button when page opened
    setTimeout(() => {
      updateCarousel();
    }, 100);
  }

  function renderSkeletonCards() {
    const carouselProductsContainer =
      document.querySelector(".carousel-products");

    carouselProductsContainer.innerHTML = "";

    for (let i = 0; i < 5; i++) {
      const skeletonCard = `
        <div class="carousel-skeleton-card">
          <div class="carousel-skeleton-box carousel-skeleton-img"></div>
          <div class="carousel-skeleton-content">
            <div class="carousel-skeleton-title"></div>
            <div class="carousel-skeleton-stars"></div>
            <div class="carousel-skeleton-price"></div>
          </div>
          <div class="carousel-skeleton-button"></div>
        </div>
      `;

      carouselProductsContainer.insertAdjacentHTML("beforeend", skeletonCard);
    }
  }

  function renderProductCards() {
    const carouselProductsContainer =
      document.querySelector(".carousel-products");

    carouselProductsContainer.innerHTML = "";

    const starIcon =
      '<svg class="star-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/></svg>';

    const discountIcon = `<svg class="discount-icon" xmlns="http://www.w3.org/2000/svg" viewBox="100 100 720 720">
      <path d="M0 0 C3.50245197 2.01708911 6.98291362 4.06774546 10.45776367 6.13183594 C11.72952565 6.88219313 13.0015015 7.63218793 14.27368164 8.38183594 C20.63687262 12.13708796 26.97971882 15.92575115 33.30932617 19.73730469 C33.88692688 20.08493362 34.46452759 20.43256256 35.05963135 20.79072571 C37.80166623 22.441942 40.54079929 24.09769413 43.27612305 25.76000977 C44.24614258 26.3467749 45.21616211 26.93354004 46.21557617 27.53808594 C47.06265137 28.05306641 47.90972656 28.56804687 48.7824707 29.09863281 C56.83871231 33.61953158 67.99697248 31.19556041 76.84448242 30.44433594 C79.10554273 30.26195249 81.36661068 30.07966381 83.62768555 29.89746094 C87.13136525 29.60986916 90.63485873 29.32020283 94.13818359 29.02832031 C131.70600179 25.91641257 131.70600179 25.91641257 138.95776367 30.31933594 C145.18782535 35.76817808 149.2580074 43.30192215 153.45776367 50.31933594 C154.50289703 52.04114428 155.54804969 53.76294138 156.5945282 55.4839325 C157.30974692 56.66086554 158.02402718 57.83836938 158.73738098 59.01643372 C162.48920717 65.21168127 166.30970595 71.36305337 170.14526367 77.50683594 C170.7562793 78.49103516 171.36729492 79.47523438 171.99682617 80.48925781 C173.63289796 83.11098086 175.29001287 85.71768714 176.95776367 88.31933594 C177.38557129 89.0101123 177.81337891 89.70088867 178.25415039 90.41259766 C181.07159401 94.72477886 184.09697378 97.00003387 188.70776367 99.06933594 C189.39185303 99.39385742 190.07594238 99.71837891 190.78076172 100.05273438 C193.16162821 101.16867617 195.55671915 102.2475148 197.95776367 103.31933594 C198.86671387 103.72667969 199.77566406 104.13402344 200.7121582 104.55371094 C209.92470464 108.66537676 219.15562565 112.73755864 228.46336365 116.62954712 C231.5091738 117.90781419 234.54451227 119.21072488 237.58276367 120.50683594 C238.71431885 120.96928711 239.84587402 121.43173828 241.01171875 121.90820312 C247.84710427 124.84848668 253.18823122 127.72369818 256.95776367 134.31933594 C259.28138294 142.94874315 259.44305724 152.11344314 259.88745117 160.99121094 C259.96361311 162.36743069 260.0408756 163.74358992 260.11917114 165.11968994 C260.4469925 170.89851175 260.7631628 176.67783546 261.05688477 182.45849609 C261.23858494 186.01998875 261.4376205 189.58017007 261.64740372 193.14011383 C261.75976986 195.13119915 261.85312602 197.12332847 261.9460144 199.11541748 C262.48424728 208.08507837 264.14572362 214.18534366 269.84838867 221.29980469 C270.38496094 221.97817383 270.9215332 222.65654297 271.47436523 223.35546875 C272.04638672 224.06541992 272.6184082 224.77537109 273.20776367 225.50683594 C274.45877043 227.0880712 275.70872729 228.67013754 276.95776367 230.25292969 C277.6100293 231.07647949 278.26229492 231.9000293 278.93432617 232.74853516 C309.59315667 271.70093443 309.59315667 271.70093443 309.3684082 281.39697266 C308.54059725 287.28811244 305.86374303 292.52330798 303.39526367 297.88183594 C302.81577349 299.18020011 302.23809375 300.47937365 301.66210938 301.77929688 C298.78943722 308.22956619 295.81977323 314.6333432 292.81150818 321.02134705 C291.41917144 323.98185423 290.03884928 326.9479139 288.6579895 329.91378784 C287.66545928 332.02635037 286.65037196 334.12695123 285.63330078 336.2277832 C285.01527803 337.54432921 284.39812905 338.86128586 283.78198242 340.17871094 C283.23630615 341.31791992 282.69062988 342.45712891 282.12841797 343.63085938 C279.28544818 352.58843758 281.49069945 360.89624985 283.73570251 369.79945755 C284.25050039 371.8414618 284.75081968 373.88657416 285.2479248 375.93295288 C286.30509211 380.27327441 287.38078857 384.6088948 288.45776367 388.94433594 C289.70677476 393.98124689 290.94793446 399.0199406 292.17503357 404.06223679 C292.66584849 406.06488188 293.16792078 408.06446746 293.67077637 410.06411743 C295.81364027 418.82952306 297.65614624 426.55676762 293.52807617 434.97167969 C288.13290824 443.03758996 279.12288208 448.84222176 271.47338867 454.62402344 C266.88814792 458.10849413 262.44410818 461.76540342 257.99487305 465.42089844 C254.70826129 468.11369725 251.40360467 470.76145174 248.00463867 473.31152344 C247.37549561 473.7879126 246.74635254 474.26430176 246.09814453 474.75512695 C244.92768195 475.63668679 243.74940556 476.50802365 242.56152344 477.3659668 C234.20854976 483.68908077 231.76629056 492.32274635 229.27897835 502.14358521 C228.73174544 504.30088802 228.16662056 506.45281172 227.5967865 508.60424805 C225.98195484 514.71548268 224.40224176 520.83570422 222.82617188 526.95703125 C221.85650442 530.71805314 220.86907849 534.47407537 219.87161064 538.22781372 C219.31808844 540.33363967 218.78569759 542.44407795 218.25367737 544.55541992 C216.18375135 552.51799851 214.09346367 559.68964814 207.11709595 564.62023926 C202.26889237 567.30841486 197.23061994 568.29169893 191.79760742 569.10058594 C190.9380394 569.23949753 190.07847137 569.37840912 189.19285583 569.52153015 C187.36767349 569.81486615 185.54153014 570.10227654 183.71453857 570.38412476 C180.87047667 570.8231623 178.02947039 571.27857571 175.1887207 571.73852539 C169.06857954 572.72686199 162.94498091 573.69266423 156.82073975 574.6552124 C152.98900777 575.25831199 149.16036616 575.87812546 145.33276367 576.50683594 C144.46643311 576.63703125 143.60010254 576.76722656 142.70751953 576.90136719 C134.90828533 578.18874963 128.71642891 580.73354685 123.52026367 586.88183594 C122.76616211 587.76226563 122.01206055 588.64269531 121.23510742 589.54980469 C118.2535681 593.17572472 115.2918775 596.81720908 112.34057617 600.46777344 C109.35675254 604.03857876 106.21128415 607.43518589 103.04199219 610.84057617 C100.07089617 614.05197001 97.2582978 617.34543357 94.52026367 620.75683594 C77.7417108 641.37734725 77.7417108 641.37734725 68.95776367 642.31933594 C61.93288543 642.17926705 55.50019591 640.1458869 48.87963867 637.96777344 C47.8323761 637.63065338 46.78511353 637.29353333 45.70611572 636.94619751 C42.37067921 635.87025125 39.03925843 634.7824178 35.70776367 633.69433594 C33.51790671 632.98653941 31.32780424 632.27950196 29.13745117 631.57324219 C26.96805033 630.87182125 24.79877874 630.17000041 22.62963867 629.46777344 C21.56289917 629.12252625 20.49615967 628.77727905 19.39709473 628.42156982 C14.23995077 626.74387948 9.0998616 625.03190205 3.9831543 623.234375 C3.04127258 622.90740631 2.09939087 622.58043762 1.12896729 622.24356079 C-0.61648223 621.63500709 -2.35815788 621.01545581 -4.0947876 620.38217163 C-12.48424806 617.47054801 -19.10402241 617.59779078 -27.53051758 620.55761719 C-28.21945099 620.7944371 -28.9083844 621.03125702 -29.61819458 621.2752533 C-31.09799875 621.7849022 -32.57581095 622.30036632 -34.05172729 622.82116699 C-38.02422728 624.21950383 -42.01507237 625.56394318 -46.00317383 626.91699219 C-46.82585251 627.19735321 -47.64853119 627.47771423 -48.49613953 627.76657104 C-56.68765723 630.55379753 -64.90464477 633.25270882 -73.16195679 635.8387146 C-74.686865 636.31940332 -76.20960467 636.80703586 -77.72988892 637.30215454 C-99.62360966 644.42285833 -99.62360966 644.42285833 -109.10473633 639.63183594 C-115.17436666 635.13105073 -120.08139659 628.97166455 -125.04223633 623.31933594 C-125.67000977 622.61550781 -126.2977832 621.91167969 -126.94458008 621.18652344 C-129.58376681 618.2053394 -132.16524394 615.17581198 -134.74536133 612.14355469 C-140.5657495 605.31150277 -146.46193457 598.58503582 -152.58129883 592.01855469 C-155.24057803 589.10178973 -157.72167483 586.07725452 -160.11645508 582.94042969 C-165.77976594 578.17313961 -174.13735355 577.37470923 -181.19848633 576.16308594 C-182.25902222 575.9746814 -183.31955811 575.78627686 -184.41223145 575.59216309 C-187.7876804 574.99404657 -191.16484813 574.40639268 -194.54223633 573.81933594 C-196.7793424 573.42552489 -199.0163229 573.03099983 -201.25317383 572.63574219 C-202.34454651 572.44308777 -203.43591919 572.25043335 -204.56036377 572.05194092 C-206.72263166 571.6700264 -208.88486357 571.28790816 -211.04705811 570.90557861 C-212.0815509 570.7227533 -213.1160437 570.53992798 -214.18188477 570.3515625 C-215.17700073 570.17564575 -216.1721167 569.999729 -217.1973877 569.81848145 C-219.80881871 569.36029044 -222.4217975 568.91239256 -225.03540039 568.46679688 C-226.47004037 568.21491471 -227.90461652 567.96266855 -229.33911133 567.70996094 C-230.53890625 567.5040332 -231.73870117 567.29810547 -232.97485352 567.0859375 C-238.97769433 565.58570508 -242.47542015 562.61784227 -245.89501953 557.60131836 C-248.80572562 552.41997719 -250.026331 546.69754859 -251.46066093 540.97120857 C-251.98561172 538.87798828 -252.5241098 536.78866274 -253.06617737 534.69981384 C-254.60331824 528.76531899 -256.11376305 522.82408151 -257.62158203 516.88208008 C-258.54841855 513.23351155 -259.48868582 509.5886017 -260.43651009 505.94543266 C-260.963877 503.90083419 -261.47531151 501.85267884 -261.98643494 499.80397034 C-264.27552121 490.99846129 -266.8744927 483.514636 -273.97973633 477.50683594 C-274.75833008 476.84683594 -275.53692383 476.18683594 -276.33911133 475.50683594 C-281.24965666 471.53298422 -286.20840577 467.62485629 -291.19848633 463.75146484 C-299.44414621 457.346666 -307.65581267 450.90397788 -315.69848633 444.24511719 C-317.09745593 443.0956305 -318.50993525 441.96185295 -319.94848633 440.86230469 C-324.26349138 437.53086696 -326.55077681 433.98617055 -327.54614258 428.58496094 C-327.82161692 414.40721485 -323.4181396 400.71952538 -319.97290039 387.08789062 C-319.04385212 383.41186472 -318.12591056 379.73316958 -317.21191406 376.05337524 C-316.68004613 373.93290649 -316.13230219 371.81700159 -315.58325195 369.70092773 C-311.99132421 355.5901481 -312.2986243 347.24796692 -318.66723633 334.06933594 C-319.25046407 332.82311754 -319.83147384 331.57585903 -320.41040039 330.32763672 C-321.63377364 327.69518627 -322.86722475 325.0678078 -324.10766602 322.44335938 C-327.10248086 316.08617212 -329.97536246 309.67349342 -332.85882568 303.26525879 C-333.78059149 301.22017191 -334.70685689 299.17718265 -335.63452148 297.13476562 C-336.20272587 295.88118842 -336.77092287 294.62760786 -337.33911133 293.37402344 C-337.83765625 292.27558105 -338.33620117 291.17713867 -338.84985352 290.04541016 C-340.33668728 286.64615015 -341.2305808 283.82382936 -341.35473633 280.13183594 C-341.39211914 279.41640625 -341.42950195 278.70097656 -341.46801758 277.96386719 C-340.30852469 270.76224623 -335.51543518 264.95913748 -331.10473633 259.38183594 C-329.93662549 257.87934223 -328.76866075 256.37673492 -327.60083008 254.87402344 C-326.71113525 253.73658691 -326.71113525 253.73658691 -325.8034668 252.57617188 C-321.42702331 246.96820908 -317.12492063 241.30246904 -312.81469727 235.64355469 C-311.55439854 233.99093156 -310.29178376 232.34007355 -309.02758789 230.69042969 C-306.94270876 227.9674013 -304.86672136 225.23778793 -302.79223633 222.50683594 C-302.13562012 221.6524292 -301.47900391 220.79802246 -300.80249023 219.91772461 C-300.1958252 219.11568604 -299.58916016 218.31364746 -298.96411133 217.48730469 C-298.42367187 216.77856201 -297.88323242 216.06981934 -297.32641602 215.33959961 C-294.769362 211.31685779 -294.81765496 207.06202078 -294.54907227 202.3828125 C-294.46436344 200.95314367 -294.37962491 199.52347659 -294.29486084 198.09381104 C-294.22976444 196.9617561 -294.22976444 196.9617561 -294.16335297 195.80683136 C-293.92942308 191.79193781 -293.67326892 187.77843286 -293.42114258 183.76464844 C-293.10224755 178.66535897 -292.78981615 173.56591858 -292.50073242 168.46484375 C-292.26611235 164.33509875 -292.0095316 160.2072193 -291.73859406 156.07970428 C-291.63974362 154.51263258 -291.54884427 152.94503701 -291.46630096 151.37702179 C-290.95931221 141.83138369 -290.3122697 134.34099194 -283.06860352 127.4387207 C-277.04499852 123.66393815 -270.75039127 120.79089272 -264.19577026 118.05270386 C-261.57369593 116.95641405 -258.96125602 115.83796852 -256.3480072 114.72084045 C-254.98534437 114.13846131 -253.62227303 113.55703713 -252.25880432 112.97654724 C-245.4431286 110.07345211 -238.65435975 107.11160198 -231.88513184 104.10183716 C-230.62514995 103.54306276 -229.36385261 102.98724424 -228.10119629 102.43453979 C-226.33753098 101.66235518 -224.57845483 100.87971481 -222.81958008 100.09667969 C-221.82176514 99.65573975 -220.8239502 99.2147998 -219.79589844 98.76049805 C-215.22386838 96.36767125 -211.93312096 93.67670455 -209.27270508 89.24902344 C-208.78431152 88.44770996 -208.29591797 87.64639648 -207.79272461 86.82080078 C-207.27693848 85.95406738 -206.76115234 85.08733398 -206.22973633 84.19433594 C-205.08533947 82.3088377 -203.94080146 80.42342512 -202.79614258 78.53808594 C-202.1917334 77.53519531 -201.58732422 76.53230469 -200.96459961 75.49902344 C-198.25323266 71.01428339 -195.50669186 66.55144364 -192.75830078 62.08935547 C-191.3994642 59.88316966 -190.04242829 57.6758734 -188.6875 55.46728516 C-186.81241092 52.4137936 -184.92903759 49.3656018 -183.04223633 46.31933594 C-182.41438232 45.29880127 -181.78652832 44.2782666 -181.13964844 43.22680664 C-180.5312915 42.2505835 -179.92293457 41.27436035 -179.29614258 40.26855469 C-178.75803955 39.40061279 -178.21993652 38.5326709 -177.66552734 37.63842773 C-174.46818516 33.07058996 -170.24187626 29.39223408 -165.04223633 27.31933594 C-162.45425337 27.11798257 -160.00334396 27.03657493 -157.41723633 27.06933594 C-156.63872314 27.07465332 -155.86020996 27.0799707 -155.05810547 27.08544922 C-143.69009213 27.25947752 -132.36382761 28.35081744 -121.04223633 29.31933594 C-117.62849808 29.60772545 -114.2146135 29.89387798 -110.80029297 30.17529297 C-108.69625397 30.34903976 -106.59254175 30.52681241 -104.48925781 30.70947266 C-90.73058599 32.08688271 -90.73058599 32.08688271 -78.16723633 27.38183594 C-77.42892578 26.95016113 -76.69061523 26.51848633 -75.92993164 26.07373047 C-73.2844728 24.51466629 -70.66341164 22.9188861 -68.04223633 21.31933594 C-66.34463147 20.29335751 -64.64701361 19.26740048 -62.94906616 18.24198914 C-58.73088256 15.69364434 -54.51536691 13.14129611 -50.31616211 10.56176758 C-44.43405992 6.95069248 -38.52728508 3.38583344 -32.55786133 -0.07910156 C-31.45216797 -0.72282715 -30.34647461 -1.36655273 -29.20727539 -2.02978516 C-17.91240737 -7.9211688 -10.53875919 -5.82207032 0 0 Z " fill="#00A865" transform="translate(528.042236328125,196.6806640625)"/>
      <path d="M0 0 C4.08165943 2.84929545 6.86857935 6.7096123 8.82421875 11.2734375 C9.02263818 14.29884757 9.10949911 17.23268902 9.10269165 20.25836182 C9.10848405 21.17649524 9.11427645 22.09462867 9.12024438 23.04058433 C9.13727909 26.12377127 9.14012389 29.20680883 9.14306641 32.29003906 C9.15236218 34.49750131 9.16253032 36.70496003 9.17350769 38.91241455 C9.20086126 44.91197885 9.21597299 50.91151961 9.22893572 56.91112995 C9.24454282 63.17855348 9.27134074 69.44592874 9.29696655 75.71331787 C9.33847313 86.23496973 9.37305535 96.75662827 9.40234375 107.27832031 C9.43252951 118.11557917 9.4668799 128.95281163 9.50683594 139.79003906 C9.51052826 140.79209324 9.51052826 140.79209324 9.51429518 141.81439093 C9.52666978 145.16574061 9.53912631 148.51708997 9.55162358 151.8684392 C9.65500726 179.67006944 9.74424672 207.47173076 9.82421875 235.2734375 C10.44706631 234.64920725 10.44706631 234.64920725 11.08249664 234.01236629 C21.21347536 223.85924694 31.34726429 213.70893888 41.48413849 203.56170559 C46.38630183 198.65439877 51.28753018 193.74616506 56.18652344 188.83569336 C60.91747488 184.09366254 65.65107507 179.3542906 70.38627625 174.61650276 C72.18917657 172.81175988 73.99119894 171.0061395 75.79231262 169.19961357 C78.32208828 166.66254132 80.85501474 164.1286542 83.38867188 161.59545898 C84.12667023 160.85386536 84.86466858 160.11227173 85.62503052 159.34820557 C89.6730693 155.30810548 93.81598385 151.44403072 98.15691948 147.7195406 C100.09494805 146.03862514 101.90185498 144.26670252 103.67578125 142.4140625 C104.2996875 141.77339844 104.92359375 141.13273438 105.56640625 140.47265625 C106.83319852 139.16118458 108.09616111 137.846004 109.35546875 136.52734375 C113.53418066 132.25326704 117.25633685 128.82819963 123.38671875 127.875 C129.49338007 127.9337179 133.94778812 128.41054302 138.484375 132.92578125 C142.43595848 137.34445498 143.97687563 140.4998759 144.13671875 146.5234375 C144.17410156 147.43609375 144.21148438 148.34875 144.25 149.2890625 C143.33269876 155.71858676 139.14734708 160.32506318 134.68951416 164.77563477 C134.18538049 165.28303727 133.68124683 165.79043978 133.16183639 166.31321812 C131.4863383 167.99594513 129.8004197 169.6678078 128.11425781 171.33984375 C126.90435153 172.55054166 125.69509929 173.76189347 124.4864502 174.97384644 C121.21204693 178.25336998 117.92841433 181.52350633 114.64288807 184.79188156 C111.1982169 188.22147171 107.76169603 191.65921049 104.32415771 195.09594727 C98.54891288 200.86750294 92.76806908 206.63340011 86.98339844 212.39550781 C79.57405368 219.77601013 72.17396434 227.16571985 64.77679825 234.5584259 C58.40033787 240.93089473 52.01962763 247.29910342 45.63823986 253.66663742 C43.59578134 255.70501178 41.55389848 257.74396144 39.51209259 259.7829895 C36.29372771 262.99643076 33.0727117 266.20719244 29.84968567 269.4159584 C28.67180777 270.58934538 27.4947419 271.76354819 26.31858063 272.93865585 C20.80625379 278.44494148 15.29773606 283.90683102 9.3564415 288.95697021 C6.88989998 291.07619291 4.69270308 293.42992378 2.46484375 295.79296875 C-1.31831197 299.20681641 -4.51611019 299.56833376 -9.55078125 299.5859375 C-10.65164063 299.60269531 -11.7525 299.61945313 -12.88671875 299.63671875 C-20.63312697 298.78111784 -25.05236081 293.80160198 -30.2421875 288.5 C-30.99870102 287.73924164 -31.75521454 286.97848328 -32.53465271 286.19467163 C-34.94302341 283.76957107 -37.34075201 281.33425208 -39.73828125 278.8984375 C-41.35412111 277.26753871 -42.97065063 275.6373229 -44.58789062 274.0078125 C-48.16039085 270.40592084 -51.72620602 266.79756076 -55.28614807 263.18325806 C-57.5738654 260.87110053 -59.87492569 258.57251895 -62.17578125 256.2734375 C-63.79177349 254.65285641 -65.40739947 253.03191002 -67.02270508 251.41064453 C-71.66202523 246.75498387 -76.3038869 242.1018661 -80.94720936 237.45019722 C-83.7458445 234.64634728 -86.54353636 231.84156932 -89.33911133 229.03466797 C-92.05941588 226.30341958 -94.78222685 223.57469226 -97.50671959 220.84762192 C-98.53649552 219.81601574 -99.5653996 218.7835384 -100.59336281 217.75012589 C-105.64642148 212.67133684 -110.73573621 207.7026603 -116.17692566 203.03753662 C-120.27639716 199.41952934 -124.12229952 195.53204695 -128.00390625 191.68359375 C-128.91533386 190.78023788 -129.82676147 189.87688202 -130.76580811 188.94615173 C-132.6805498 187.04630402 -134.59278805 185.14397057 -136.50390625 183.24047852 C-138.93853124 180.81696541 -141.38463 178.40537797 -143.8333931 175.99616337 C-146.19059373 173.67152226 -148.53368499 171.33281859 -150.87890625 168.99609375 C-151.7518634 168.14064468 -152.62482056 167.28519562 -153.52423096 166.40382385 C-159.1724574 160.73531596 -164.75266409 154.78807717 -164.73828125 146.2734375 C-164.44015539 140.01279439 -161.99714081 135.84456561 -157.4140625 131.66796875 C-152.95336379 128.43780761 -149.11374768 127.73326745 -143.66796875 127.8046875 C-137.07099008 129.04549854 -132.76822677 133.16223287 -128.11523438 137.65258789 C-127.42726021 138.30740426 -126.73928604 138.96222063 -126.03046417 139.63687992 C-117.0772812 148.20659889 -108.33146534 156.98963905 -99.58178902 165.7660358 C-97.1320175 168.22217811 -94.67929864 170.67537411 -92.22692871 173.12892151 C-87.61073672 177.74818724 -82.99709317 182.36998919 -78.38442564 186.99277407 C-73.12137021 192.26711564 -67.85537963 197.53852275 -62.58917522 202.80971992 C-51.78150703 213.62776259 -40.97741784 224.44937216 -30.17578125 235.2734375 C-30.17431469 234.12545402 -30.17284813 232.97747053 -30.17133713 231.79469967 C-30.13562658 204.53708747 -30.07937308 177.27958175 -29.9978603 150.02206626 C-29.98784297 146.66632261 -29.97799882 143.31057846 -29.96826172 139.95483398 C-29.96534966 138.95274168 -29.96534966 138.95274168 -29.96237877 137.93040509 C-29.93136705 127.11664024 -29.91438044 116.30289661 -29.90258703 105.48909568 C-29.89017116 94.39115312 -29.86236294 83.29331345 -29.82116818 72.19543892 C-29.79852006 65.96273282 -29.78287259 59.73018552 -29.7838974 53.49743462 C-29.78464202 47.63118047 -29.76677057 41.76527783 -29.73461342 35.89911461 C-29.72609369 33.74608208 -29.7243785 31.59301021 -29.72997856 29.43996811 C-29.73660856 26.49927567 -29.71872116 23.55970488 -29.69476318 20.61912537 C-29.7025236 19.76794284 -29.71028402 18.91676031 -29.7182796 18.03978437 C-29.6259522 11.63423694 -27.99994289 7.42985345 -23.6484375 2.56640625 C-16.01579957 -3.41707445 -8.59362462 -4.76110441 0 0 Z " fill="#FDFEFE" transform="translate(522.17578125,351.7265625)"/>
      <path d="M0 0 C0 3 0 3 -2.21557617 5.5402832 C-3.23391041 6.55135535 -4.26031967 7.55433387 -5.29296875 8.55078125 C-5.83601151 9.08720749 -6.37905426 9.62363373 -6.93855286 10.17631531 C-8.68127126 11.8955946 -10.43377703 13.60445316 -12.1875 15.3125 C-13.92168505 17.01144622 -15.65366554 18.71255343 -17.38288879 20.41654968 C-18.45929293 21.47619359 -19.53877638 22.53272208 -20.62187195 23.58552551 C-23.13959604 26.05412452 -25.4504401 28.52880332 -27.62231445 31.30932617 C-30.05071256 34.05738815 -30.61927928 34.39405987 -34 35 C-29.97251947 30.16701194 -25.75620587 25.61889996 -21.2890625 21.19140625 C-20.36956314 20.27402931 -20.36956314 20.27402931 -19.43148804 19.33811951 C-17.49835436 17.41052441 -15.56175013 15.48646072 -13.625 13.5625 C-12.30315301 12.24567596 -10.98153628 10.92862074 -9.66015625 9.61132812 C-6.44275701 6.40487627 -3.22224319 3.20158371 0 0 Z " fill="#059845" transform="translate(663,509)"/>
      <path d="M0 0 C0 5.20371795 -4.50495016 8.4209656 -8 12 C-9.62292238 13.3862462 -11.2668549 14.75430196 -13 16 C-13.66 15.67 -14.32 15.34 -15 15 C-10.05 10.05 -5.1 5.1 0 0 Z " fill="#019B48" transform="translate(625,547)"/>
      <path d="M0 0 C0.33 0.99 0.66 1.98 1 3 C-0.24034412 4.32162881 -1.49268626 5.63200453 -2.75 6.9375 C-3.44609375 7.66839844 -4.1421875 8.39929688 -4.859375 9.15234375 C-7.00599725 11.00517646 -8.23532932 11.60771565 -11 12 C-7.49102731 7.81576108 -3.91939465 3.80411834 0 0 Z " fill="#019E4C" transform="translate(585,587)"/>
      <path d="M0 0 C2.76223278 2.76223278 2.57856291 5.20706617 3 9 C2.01 8.67 1.02 8.34 0 8 C-1.125 2.25 -1.125 2.25 0 0 Z " fill="#0FA661" transform="translate(817,594)"/>
      <path d="M0 0 C0 4.38968456 -2.12805101 5.76905739 -5 9 C-5.99 8.67 -6.98 8.34 -8 8 C-5.36 5.36 -2.72 2.72 0 0 Z " fill="#009C48" transform="translate(598,574)"/>
      </svg>`;

    const filledHeartIcon = `    
      <svg width="26" height="23" viewBox="0 0 26 23" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g id="Group 3">
      <g id="heart">
      <path id="Shape" fill-rule="evenodd" clip-rule="evenodd" d="M22.6339 2.97449C21.4902 1.83033 19.9388 1.1875 18.3211 1.1875C16.7034 1.1875 15.152 1.83033 14.0084 2.97449L12.8332 4.14968L11.658 2.97449C9.27612 0.592628 5.41435 0.592627 3.03249 2.97449C0.650628 5.35635 0.650628 9.21811 3.03249 11.6L4.20769 12.7752L12.8332 21.4007L21.4587 12.7752L22.6339 11.6C23.778 10.4564 24.4208 8.90494 24.4208 7.28723C24.4208 5.66952 23.778 4.11811 22.6339 2.97449Z" stroke="#FF8A00" stroke-width="2.17391" stroke-linecap="round" stroke-linejoin="round" fill="#FF8A00" />
      </g>
      </g>
      </svg>`;

    const updateFavoriteButton = (button, isFavorite) => {
      if (isFavorite) {
        button.innerHTML = filledHeartIcon;
      } else {
        button.innerHTML = `<img src="assets/svg/default-favorite.svg" alt="Add to favorites" class="favorite-button-icon favorite-button-default-icon">
            <img src="assets/svg/default-hover-favorite.svg" alt="Add to favorites" class="favorite-button-icon hovered">`;
      }
    };

    const localStorageFavorites =
      localStorage.getItem("favorite_products") || "[]";
    let favs = JSON.parse(localStorageFavorites);

    const toggleFavorite = (e) => {
      const localStorageFavorites =
        localStorage.getItem("favorite_products") || "[]";

      // Add to localStorage
      try {
        favs = JSON.parse(localStorageFavorites);
        const productId = e.target
          .closest(".favorite-button")
          .getAttribute("data-product-id");
        const button = e.target.closest(".favorite-button");

        if (favs.includes(productId)) {
          localStorage.setItem(
            "favorite_products",
            JSON.stringify(favs.filter((favId) => favId != productId))
          );
          return updateFavoriteButton(button, false);
        }

        localStorage.setItem(
          "favorite_products",
          JSON.stringify([...favs, productId])
        );
        updateFavoriteButton(button, true);
      } catch (e) {
        console.error("Error during favoriting");
      }
    };

    data.forEach((product) => {
      const productElementTemplate = `
        <div class="carousel-product-card">
          <button class="favorite-button" data-product-id="${product.id}">
            ${
              favs.includes(JSON.stringify(product.id))
                ? filledHeartIcon
                : `<img src="assets/svg/default-favorite.svg" alt="Add to favorites" class="favorite-button-icon favorite-button-default-icon">
            <img src="assets/svg/default-hover-favorite.svg" alt="Add to favorites" class="favorite-button-icon hovered">`
            }
          </button>
        
          <a href="${product.url || "#"}" target="_blank">
          <img alt="${product.name || ""}" src="${
        product.img || ""
      }" class="carousel-product-img" />
            <div class="carousel-product-content">
              <h3 class="carousel-product-title"><b>${product.brand} - </b>${
        product.name || ""
      }</h3>

              <div class="stars-container">
                ${Array(5)
                  .fill(null)
                  .map(() => starIcon)
                  .join("")}
              </div>

              <div class="price-container">
                ${
                  product.price < product.original_price
                    ? `<div class="product-discount-container">
                  <span class="product-old-price">${
                    product.original_price
                  }</span>

                  <span class="product-discount-percentage">%${Math.ceil(
                    ((product.original_price - product.price) /
                      product.original_price) *
                      100
                  )}${discountIcon}</span>
                  </div>`
                    : ""
                }
              
                <span class="${
                  product.price < product.original_price
                    ? "product-discounted-price product-price"
                    : "product-price"
                }">${product.price} TL</span>
                  
              </div>
            </div>
          </a>

          <div class="carousel-product-bottom">
            <button class="carousel-product-add-to-cart">
              Sepete Ekle
            </button>
          </div>
        </div>
      `;

      carouselProductsContainer.insertAdjacentHTML(
        "beforeend",
        productElementTemplate
      );
    });

    // Add favorite functionality to all favorite buttons
    const favButtons = document.querySelectorAll(".favorite-button");

    favButtons.forEach((btn) => {
      btn.addEventListener("click", toggleFavorite);
    });
  }

  async function fetchProducts() {
    const localStorageData = localStorage.getItem(PRODUCTS_LOCALSTORAGE_KEY);

    // Fetch if localStorage is empty, otherwise use data from localStorage
    if (localStorageData && JSON.parse(localStorageData)) {
      data = JSON.parse(localStorageData);
      return renderProductCards();
    }

    // Show skeleton while fetching API data
    renderSkeletonCards();

    const response = await fetch(FETCH_PRODUCTS_URL);
    data = await response.json();
    renderProductCards();

    // Save data to localStorage
    localStorage.setItem(PRODUCTS_LOCALSTORAGE_KEY, JSON.stringify(data));
  }

  init();
})();
